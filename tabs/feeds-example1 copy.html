<div>
  <p>This is an example of an api.js handling of a RESTful api call, expecting https://feedsapi.damibu.com/prod/APIKEY/feed/9/articles/101 would result it get_feeds_id_articles_id for feedID: 9 and articleID: 101 using the given APIKEY for validation, it also uses the httpMethod for get / post etc.</p>
  <p>After building the request name it would then search in side /requests directory for a request of that name and return the result of calling that request.</p>
  <div class="code-example">
    <div class="code-header">
      <span>Code Snippet 1</span>
      <span class="code-language">React.js</span>
    </div>
    <div class="code-content">
      <pre><code>
exports.handler = async function (event) {
  let variables = {};
  if (!event.httpMethod) {
    event.httpMethod = event?.requestContext?.httpMethod?.method;
  }
  if (event.httpMethod === undefined) return 501;

  // RESTFUL handling of path into variables...
  let splitPath = event.path?.split("/") || event.rawPath?.split("/");
  if (splitPath?.length > 0) {
    while (splitPath.length && splitPath[0].length != 32) splitPath.shift();
    if (splitPath.length && splitPath[0].length == 32) {
      variables.apikey = splitPath[0];              // Always need an api key
      variables.request = event.httpMethod;
      let i;
      for (i = 1; i < splitPath.length; i++) {
        if ((i & 1) == 0) {
          variables.request += "_id";
          variables[toLowerCaseSingular(splitPath[i - 1]) + "_id"] = isNaN(parseInt(splitPath[i]))
            ? splitPath[i]
            : parseInt(splitPath[i]);
        } else {
          variables.request += "_" + splitPath[i];
        }
      }

      variables.request = variables.request.toLowerCase();
    }
  }

  if (event.queryStringParameters) {
    if (event.queryStringParameters.variables) {
      Object.assign(variables,JSON.parse(event.queryStringParameters.variables));
    } else {
      Object.assign(variables, event.queryStringParameters);
    }
  }

  if (event.body) {
    let jsonBody = JSON.parse(event.body);
    if (jsonBody) {
      Object.assign(variables, jsonBody);
    }
  }

  Object.keys(variables).forEach((key) => {
    if (typeof variables[key] === "string" && variables[key] !== "") {
      variables[key] = isNaN(variables[key])
        ? variables[key]
        : parseFloat(variables[key]);
    }
  });

  // authenticate
  if (!["user_sign_in"].includes(variables.request)) {
    const authenticate = require("./authenticate");
    const authRes = await authenticate.handler(variables, db);
    console.log(authRes);
    if (authRes.statusCode != 200) {
      return authRes;
    }
    variables.identityData = authRes.identityData;
  }

  let request;
  try {
    request = require(`./requests/${variables.request}`);
  } catch (e) {
    console.log("could not find request", variables.request);
    return 501;
  }

  const requestResult = await request.handler(variables, db);
  return requestResult;
};
</code></pre>
    </div>
  </div>
</div>
